{% extends "base.html" %}

{% block content %}

<script type="text/javascript">
            $(document).ready(function() {
              showGroup();
            });
            function creategroup_submit() {
	            check_group_name = $('#group_name').val();
	            check_group_intro = $('#intro').val();
	            check_time = $('#finished_time_date').val();
	            nosubmit = 0;
	            if(check_time == '') {
		            $('#finished_time_date').attr('style','border: 1px solid red');
		            nosubmit =1;
	            } else {
		            $('#finished_time_date').removeAttr('style');
	            }
	            if(check_group_intro =='') {
		            $('#introdiv').attr('class','form-group has-error');
		            nosubmit =1;
	            } else {
		            $('#introdiv').attr('class','form-group');
	            }
	            if(check_group_name=='') {
		            $('#namediv').attr('class','form-group has-error');
		            nosubmit =1;
	            } else {
		            $('#namediv').attr('class','form-group');
	            }
	            if(nosubmit==1)return false;

	            creator_id = Cookies.get('user_id');
	            group_name = document.getElementById("group_name").value;
	            intro = document.getElementById("intro").value;
	            finished_time = document.getElementById("finished_time_date").value;

	            if(document.getElementById("private_op1").checked) {
		            private = 0;
	            } else {
		            private = 1;
	            }

	            date = Date.now();
	            group_id = creator_id + date;
	            member_limit = parseInt(document.getElementsByName("member_limit")[0].value);
	            $.post( "/index/", { group_id : group_id, group_name : group_name,  member_limit :member_limit,intro:intro,private:private,creator_id:creator_id ,finished_time:finished_time})
			            .then(function () {
				            window.location = '/group/'+group_id;
			            });
            }
            function logout() {
	            Cookies.remove('user_id');
	            window.location = '/index/';
            }
            function showGroup() {
                $('#myContent').empty();
                {% if user_page_data %}
	                var groups = '';
                    {% for page_data in user_page_data %}
	                    // calculate progress
	                    var ct = new Date({{ page_data.created_time }});
						var ft = new Date({{  page_data.finish_time }});
						var nt = new Date();
	                    var alltime = ((ft - ct) / (1000 * 60 * 60 * 24));
	                    var perc = Math.floor(((nt - ct) / (1000 * 60 * 60 * 24))) / alltime;
	                    if(alltime == 0)
		                    perc = 100;


	                    var img = '<img src="{% static "images/logo.jpg" %}" class="group_img col-md-2"></img>';
                        var name = '<a href="/group/{{ page_data.group_id }}" class="col-md-10"><h4 align="center">{{ page_data.group_name }}</h4></a>';
                        var info = '<p align="center">{{ page_data.intro }}</p>';
						var progress = '<div class="progress"><div class="progress-bar progress-bar-info progress-bar-striped" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: ' + perc + '%"></div></div>'
	                    groups += '<div class="list-group-item row">' + img + name + info + progress + '</div>';

                    {% endfor %}
	                $('#myContent').append('<div class="list-group">' + groups + '</div>');
                {% endif %}
            }

            function showAchievement() {
                $('#myContent').empty();

                var div = $('<div/>', {
                    'class': 'login_achievement'
                }).html('<h4>Login Achievement</h4>');

                var img = $('<img/>', {
                    'class': 'achievement',
                    src: '{% static "images/logo.jpg" %}',
                    width: 150
                }).appendTo(div);

                var img = $('<img/>', {
                    'class': 'achievement',
                    src: '{% static "images/logo.jpg" %}',
                    width: 150
                }).appendTo(div);

                var img = $('<img/>', {
                    'class': 'achievement',
                    src: '{% static "images/logo.jpg" %}',
                    width: 150
                }).appendTo(div);

                var img = $('<img/>', {
                    'class': 'achievement',
                    src: '{% static "images/logo.jpg" %}',
                    width: 150
                }).appendTo(div);

                $('#myContent').append(div);
            }

        function showMission() {
	        $('#myContent').empty();
			// TODO:
        }

        function showMailbox() {
	        $('#myContent').empty();
	        // TODO:
        }

        </script>
        <header>
	        <div class="exp">
                <b>LV.20</b>
                <div id="user_exp">
	                <div class="progress">
		                <div class="progress-bar progress-bar-info progress-bar-striped" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width:70%">
                            <span class="sr-only">70% Complete</span>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        <br class="space">

        <div id="wrapper" style="width: 95%" align="center">
	        <!-- Sidebar Wrapper -->
	        <div id="sidebar-wrapper" style="background: transparent;">
	            <ul type="none">
		            <h3><li><a href='#' class='myLink' onclick="showGroup()">My Group</a></li></h3>
		            <h3><li><a href="#" class="myLink" onclick="showMission()">Mission</a></li></h3>
		            <h3><li><a href='#' class='myLink' onclick="showAchievement()">Achievement</a></li></h3>
		            <h3><li><a href="#" class="myLink" onclick="showMailbox()">MailBox</a></li></h3>
	            </ul>
	        </div>
	        <div id="page-content-wrapper" style="width: 100%">
		        <!-- Container -->
		        <div class="container-fluid row">
			        <div id="myContent"></div>
		        </div>
	        </div>
        </div>

{% endblock %}